-- OPTIMIZED AIM ASSIST FOR PRISON LIFE (ğŸ’¢ & CRIMINALS)
-- Place in StarterPlayerScripts as LocalScript
-- Performance Optimized: Cached variables, efficient loops, minimal allocations

print("Loading Optimized Prison Life Aim Assist...")

-- OPTIMIZATION: Cache services once at startup
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Teams = game:GetService("Teams")
local Workspace = game:GetService("Workspace")

-- OPTIMIZATION: Cache local player and camera
local player = Players.LocalPlayer
local camera = Workspace.CurrentCamera

local playerGui = player:WaitForChild("PlayerGui", 10)
if not playerGui then
    error("PlayerGui failed to load")
    return
end

-- Configuration (local variables for faster access)
local aimAssistEnabled = false
local wallCheckEnabled = true
local fovRadius = 200
local minFovRadius = 100
local maxFovRadius = 500
local predictionStrength = 0.5
local minPredictionStrength = 0.0
local maxPredictionStrength = 2.0
local predictionStep = 0.25
local bulletSpeed = 3000
local minBulletSpeed = 1000
local maxBulletSpeed = 5000
local bulletSpeedStep = 500
local smoothness = 0.25
local minSmoothness = 0.10
local maxSmoothness = 0.50
local smoothnessStep = 0.05
local reactionTime = 0.17
local aimPart = "Head"
local targetInmatesOnly = true
local targetCriminals = true

-- OPTIMIZATION: Pre-calculate commonly used values
local CRIMINAL_TEAM_NAME = "Criminals"
local INMATE_MARKER = "ğŸ’¢"

-- Weapon Presets
local weaponPresets = {
    {name = "M9 (Pistol)",    speed = 2500, smooth = 0.28, pred = 0.4, fov = 180, desc = "Standard Guard pistol\nMedium range, semi-auto"},
    {name = "AK-47",          speed = 3200, smooth = 0.22, pred = 0.6, fov = 200, desc = "High damage rifle\nFull auto, high recoil"},
    {name = "Remington 870",  speed = 1500, smooth = 0.35, pred = 0.2, fov = 250, desc = "Pump shotgun\nClose range, high spread"},
    {name = "M4A1",           speed = 3500, smooth = 0.20, pred = 0.7, fov = 190, desc = "Guard assault rifle\nFull auto, accurate"},
    {name = "Sniper",         speed = 4000, smooth = 0.15, pred = 0.8, fov = 150, desc = "Long range rifle\nHigh damage, slow fire rate"},
    {name = "Taser",          speed = 2000, smooth = 0.30, pred = 0.3, fov = 200, desc = "Non-lethal stun weapon\nShort range projectile"}
}

-- GUI Cleanup
local existingGui = playerGui:FindFirstChild("PrisonLifeAimGUI")
if existingGui then existingGui:Destroy() task.wait(0.1) end
local existingCycles = playerGui:FindFirstChild("PrisonLifeCyclesGUI")
if existingCycles then existingCycles:Destroy() task.wait(0.1) end

-- Shared Color3 constants
local COLOR_ORANGE      = Color3.fromRGB(255, 140, 0)
local COLOR_BLACK       = Color3.fromRGB(0, 0, 0)
local COLOR_RED         = Color3.fromRGB(200, 50, 50)
local COLOR_GREEN       = Color3.fromRGB(50, 200, 50)
local COLOR_DARK_BG     = Color3.fromRGB(40, 40, 45)
local COLOR_DARKER_BG   = Color3.fromRGB(30, 30, 30)
local COLOR_WHITE       = Color3.fromRGB(255, 255, 255)

local INMATE_COLOR_ACTIVE   = Color3.fromRGB(255, 100, 100)
local INMATE_COLOR_INACTIVE = Color3.fromRGB(150, 150, 150)
local CRIMINAL_COLOR_ACTIVE = COLOR_ORANGE
local CRIMINAL_COLOR_INACTIVE = Color3.fromRGB(150, 150, 150)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--   SHARED UI HELPERS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local function addCorner(parent, radius)
    local c = Instance.new("UICorner")
    c.CornerRadius = UDim.new(0, radius or 12)
    c.Parent = parent
end

local function addOrangeStroke(parent, thickness)
    local s = Instance.new("UIStroke")
    s.Color = COLOR_ORANGE
    s.Thickness = thickness or 2
    s.Parent = parent
end

local function addOrangeTitle(parent, text)
    local t = Instance.new("TextLabel")
    t.Size = UDim2.new(1, 0, 0, 40)
    t.BackgroundColor3 = COLOR_ORANGE
    t.BorderSizePixel = 0
    t.Text = text
    t.Font = Enum.Font.SourceSansBold
    t.TextSize = 16
    t.TextColor3 = COLOR_BLACK
    t.Parent = parent
    addCorner(t, 12)
    return t
end

local function makeButton(parent, y, color, text, textColor)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, -20, 0, 45)
    btn.Position = UDim2.new(0, 10, 0, y)
    btn.BackgroundColor3 = color
    btn.BorderSizePixel = 0
    btn.Text = text
    btn.Font = Enum.Font.SourceSansBold
    btn.TextSize = 15
    btn.TextColor3 = textColor or COLOR_WHITE
    btn.AutoButtonColor = false
    btn.Parent = parent
    addCorner(btn, 10)
    return btn
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--   MAIN GUI
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "PrisonLifeAimGUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 340, 0, 600)
frame.Position = UDim2.new(0.02, 0, 0.08, 0)
frame.BackgroundColor3 = COLOR_DARK_BG
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true
frame.Parent = screenGui
addCorner(frame, 12)
addOrangeStroke(frame, 2)
addOrangeTitle(frame, "PRISON LIFE AIM ASSIST")

-- Counter labels
local function makeCounter(y, text, textColor)
    local lbl = Instance.new("TextLabel")
    lbl.Size = UDim2.new(1, -20, 0, 28)
    lbl.Position = UDim2.new(0, 10, 0, y)
    lbl.BackgroundColor3 = Color3.fromRGB(60, 60, 65)
    lbl.BorderSizePixel = 0
    lbl.Text = text
    lbl.Font = Enum.Font.SourceSansBold
    lbl.TextSize = 13
    lbl.TextColor3 = textColor
    lbl.Parent = frame
    addCorner(lbl, 8)
    return lbl
end

local inmateCounter   = makeCounter(45,  "ğŸ’¢ Inmates: 0",   INMATE_COLOR_ACTIVE)
local criminalCounter = makeCounter(78,  "ğŸ”´ Criminals: 0", COLOR_ORANGE)

-- Main action buttons (cycle buttons are now in the separate panel)
local aimBtn         = makeButton(frame, 116, COLOR_RED,                    "Enable Aim Assist")
local inmateToggle   = makeButton(frame, 171, Color3.fromRGB(255,100,100),   "Target ğŸ’¢: ON")
local criminalToggle = makeButton(frame, 226, COLOR_ORANGE,                  "Target Criminals: ON", COLOR_BLACK)
local wallBtn        = makeButton(frame, 281, COLOR_GREEN,                   "Wall Check: ON",       COLOR_BLACK)
local weaponBtn      = makeButton(frame, 336, COLOR_ORANGE,                  "Weapon Presets",       COLOR_BLACK)
local listBtn        = makeButton(frame, 391, Color3.fromRGB(150,100,200),   "Show Target List")

-- Target list scrollframe
local listFrame = Instance.new("ScrollingFrame")
listFrame.Size = UDim2.new(1, -20, 0, 140)
listFrame.Position = UDim2.new(0, 10, 0, 446)
listFrame.BackgroundColor3 = COLOR_DARKER_BG
listFrame.BorderSizePixel = 0
listFrame.Visible = false
listFrame.ScrollBarThickness = 6
listFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
listFrame.Parent = frame
addCorner(listFrame, 10)

local listLayout = Instance.new("UIListLayout")
listLayout.Padding = UDim.new(0, 3)
listLayout.Parent = listFrame

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--   WEAPON PRESETS PANEL
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local weaponScreenGui = Instance.new("ScreenGui")
weaponScreenGui.Name = "PrisonLifeWeaponsGUI"
weaponScreenGui.ResetOnSpawn = false
weaponScreenGui.Parent = playerGui

local weaponFrame = Instance.new("ScrollingFrame")
weaponFrame.Size = UDim2.new(0, 420, 0, 650)
weaponFrame.Position = UDim2.new(0, 370, 0.08, 0)
weaponFrame.BackgroundColor3 = COLOR_DARK_BG
weaponFrame.BorderSizePixel = 0
weaponFrame.Visible = false
weaponFrame.ScrollBarThickness = 8
weaponFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
weaponFrame.Active = true
weaponFrame.Draggable = true
weaponFrame.Parent = weaponScreenGui
addCorner(weaponFrame, 12)
addOrangeStroke(weaponFrame, 2)
addOrangeTitle(weaponFrame, "PRISON LIFE WEAPONS")

local weaponLayout = Instance.new("UIListLayout")
weaponLayout.Padding = UDim.new(0, 10)
weaponLayout.Parent = weaponFrame

local weaponPad = Instance.new("UIPadding")
weaponPad.PaddingTop    = UDim.new(0, 50)
weaponPad.PaddingLeft   = UDim.new(0, 10)
weaponPad.PaddingRight  = UDim.new(0, 10)
weaponPad.PaddingBottom = UDim.new(0, 10)
weaponPad.Parent = weaponFrame

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--   CYCLES GUI  â€” Separate draggable panel, matching style
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local cyclesGui = Instance.new("ScreenGui")
cyclesGui.Name = "PrisonLifeCyclesGUI"
cyclesGui.ResetOnSpawn = false
cyclesGui.Parent = playerGui

local cyclesFrame = Instance.new("Frame")
cyclesFrame.Size = UDim2.new(0, 300, 0, 410)
cyclesFrame.Position = UDim2.new(0.78, 0, 0.08, 0)
cyclesFrame.BackgroundColor3 = COLOR_DARK_BG
cyclesFrame.BorderSizePixel = 0
cyclesFrame.Active = true
cyclesFrame.Draggable = true
cyclesFrame.Parent = cyclesGui
addCorner(cyclesFrame, 12)
addOrangeStroke(cyclesFrame, 2)
addOrangeTitle(cyclesFrame, "âŸ³  CYCLE SETTINGS")

-- Subtitle
local cycleSub = Instance.new("TextLabel")
cycleSub.Size = UDim2.new(1, -20, 0, 20)
cycleSub.Position = UDim2.new(0, 10, 0, 44)
cycleSub.BackgroundTransparency = 1
cycleSub.Text = "Click â–¶ to cycle each value"
cycleSub.Font = Enum.Font.SourceSans
cycleSub.TextSize = 11
cycleSub.TextColor3 = Color3.fromRGB(170, 170, 170)
cycleSub.Parent = cyclesFrame

-- Cycle card factory â€” matching the main GUI's rounded, dark style
local function makeCycleCard(y, accentColor, labelText, startValue)
    -- Card container
    local card = Instance.new("Frame")
    card.Size = UDim2.new(1, -20, 0, 56)
    card.Position = UDim2.new(0, 10, 0, y)
    card.BackgroundColor3 = Color3.fromRGB(52, 52, 58)
    card.BorderSizePixel = 0
    card.Parent = cyclesFrame
    addCorner(card, 10)

    -- Left accent bar
    local accent = Instance.new("Frame")
    accent.Size = UDim2.new(0, 4, 1, -14)
    accent.Position = UDim2.new(0, 0, 0, 7)
    accent.BackgroundColor3 = accentColor
    accent.BorderSizePixel = 0
    accent.Parent = card
    addCorner(accent, 4)

    -- Label
    local lbl = Instance.new("TextLabel")
    lbl.Size = UDim2.new(1, -62, 0, 22)
    lbl.Position = UDim2.new(0, 12, 0, 5)
    lbl.BackgroundTransparency = 1
    lbl.Text = labelText
    lbl.Font = Enum.Font.SourceSansBold
    lbl.TextSize = 11
    lbl.TextColor3 = Color3.fromRGB(190, 190, 190)
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    lbl.Parent = card

    -- Value
    local valLbl = Instance.new("TextLabel")
    valLbl.Size = UDim2.new(1, -62, 0, 24)
    valLbl.Position = UDim2.new(0, 12, 0, 27)
    valLbl.BackgroundTransparency = 1
    valLbl.Text = tostring(startValue)
    valLbl.Font = Enum.Font.SourceSansBold
    valLbl.TextSize = 16
    valLbl.TextColor3 = accentColor
    valLbl.TextXAlignment = Enum.TextXAlignment.Left
    valLbl.Parent = card

    -- Cycle button (right side, styled like main panel buttons)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0, 42, 0, 42)
    btn.Position = UDim2.new(1, -50, 0.5, -21)
    btn.BackgroundColor3 = accentColor
    btn.BorderSizePixel = 0
    btn.Text = "â–¶"
    btn.Font = Enum.Font.SourceSansBold
    btn.TextSize = 18
    btn.TextColor3 = COLOR_BLACK
    btn.AutoButtonColor = false
    btn.Parent = card
    addCorner(btn, 10)

    -- Subtle hover
    btn.MouseEnter:Connect(function()
        btn.BackgroundColor3 = Color3.new(
            math.min(accentColor.R + 0.12, 1),
            math.min(accentColor.G + 0.12, 1),
            math.min(accentColor.B + 0.12, 1)
        )
    end)
    btn.MouseLeave:Connect(function()
        btn.BackgroundColor3 = accentColor
    end)

    return btn, valLbl
end

-- 5 Cycle cards  (y positions spaced 68px apart after the 68px header area)
local aimPartCycleBtn,  aimPartVal  = makeCycleCard(70,  Color3.fromRGB(100, 150, 255), "AIM PART",          "Head")
local fovCycleBtn,      fovVal      = makeCycleCard(136, Color3.fromRGB(80,  100, 255), "FIELD OF VIEW",     tostring(fovRadius))
local speedCycleBtn,    speedVal    = makeCycleCard(202, Color3.fromRGB(255, 220,   0), "BULLET SPEED",      tostring(bulletSpeed))
local smoothCycleBtn,   smoothVal   = makeCycleCard(268, Color3.fromRGB(100, 255, 150), "SMOOTHNESS",        string.format("%.2f", smoothness))
local predCycleBtn,     predVal     = makeCycleCard(334, Color3.fromRGB(255, 150,  50), "PREDICTION MULT",   string.format("%.2fx", predictionStrength))

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--   LOGIC HELPERS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local function updateCounters()
    local ic, cc = 0, 0
    for _, p in ipairs(Players:GetPlayers()) do
        if p.Name:find(INMATE_MARKER) then ic += 1 end
        if p.Team and p.Team.Name == CRIMINAL_TEAM_NAME then cc += 1 end
    end
    inmateCounter.Text  = "ğŸ’¢ Inmates: " .. ic
    inmateCounter.TextColor3  = ic > 0 and INMATE_COLOR_ACTIVE  or INMATE_COLOR_INACTIVE
    criminalCounter.Text = "ğŸ”´ Criminals: " .. cc
    criminalCounter.TextColor3 = cc > 0 and CRIMINAL_COLOR_ACTIVE or CRIMINAL_COLOR_INACTIVE
end

local function updateTargetList()
    for _, c in ipairs(listFrame:GetChildren()) do
        if c:IsA("TextLabel") then c:Destroy() end
    end
    local targets, tc = {}, 0
    for _, p in ipairs(Players:GetPlayers()) do
        local isTarget, ttype = false, ""
        if targetInmatesOnly and p.Name:find(INMATE_MARKER) then
            isTarget, ttype = true, "ğŸ’¢ Inmate"
        elseif targetCriminals and p.Team and p.Team.Name == CRIMINAL_TEAM_NAME then
            isTarget, ttype = true, "ğŸ”´ Criminal"
        end
        if isTarget then
            tc += 1
            targets[tc] = {player = p, type = ttype}
        end
    end
    if tc == 0 then
        local nl = Instance.new("TextLabel")
        nl.Size = UDim2.new(1,-10,0,30)
        nl.BackgroundTransparency = 1
        nl.Text = "No targets found"
        nl.TextColor3 = INMATE_COLOR_INACTIVE
        nl.Font = Enum.Font.SourceSans
        nl.TextSize = 13
        nl.Parent = listFrame
    else
        for i = 1, tc do
            local t = targets[i]
            local e = Instance.new("TextLabel")
            e.Size = UDim2.new(1,-10,0,25)
            e.BackgroundColor3 = Color3.fromRGB(50,50,55)
            e.BorderSizePixel = 0
            e.Text = string.format("%d. [%s] %s", i, t.type, t.player.Name)
            e.TextColor3 = t.type:find("ğŸ’¢") and INMATE_COLOR_ACTIVE or CRIMINAL_COLOR_ACTIVE
            e.Font = Enum.Font.SourceSans
            e.TextSize = 12
            e.TextXAlignment = Enum.TextXAlignment.Left
            e.Parent = listFrame
            addCorner(e, 5)
            local ep = Instance.new("UIPadding")
            ep.PaddingLeft = UDim.new(0, 5)
            ep.Parent = e
        end
    end
end

local function populateWeapons()
    for _, c in ipairs(weaponFrame:GetChildren()) do
        if c:IsA("Frame") then c:Destroy() end
    end
    for i, w in ipairs(weaponPresets) do
        local card = Instance.new("Frame")
        card.Size = UDim2.new(1,-20,0,120)
        card.BackgroundColor3 = Color3.fromRGB(50,50,55)
        card.BorderSizePixel = 0
        card.LayoutOrder = i
        card.Parent = weaponFrame
        addCorner(card, 10)
        local st = Instance.new("UIStroke")
        st.Color = COLOR_ORANGE
        st.Thickness = 1
        st.Transparency = 0.7
        st.Parent = card

        local function lbl(text, x, y, w2, h, size, color, bold, alignX)
            local l = Instance.new("TextLabel")
            l.Size = UDim2.new(0,w2,0,h)
            l.Position = UDim2.new(0,x,0,y)
            l.BackgroundTransparency = 1
            l.Text = text
            l.Font = bold and Enum.Font.SourceSansBold or Enum.Font.SourceSans
            l.TextSize = size
            l.TextColor3 = color
            l.TextXAlignment = alignX or Enum.TextXAlignment.Left
            l.TextWrapped = true
            l.Parent = card
        end

        lbl(w.name,  5, 5,  390, 25, 16, COLOR_ORANGE,                       true)
        lbl(w.desc,  5, 30, 390, 35, 11, Color3.fromRGB(200,200,200),         false)
        lbl(string.format("Speed:%d | FOV:%d | Smooth:%.2f", w.speed, w.fov, w.smooth),
            5, 60, 390, 25, 11, Color3.fromRGB(150,200,255), false)

        local apply = Instance.new("TextButton")
        apply.Size = UDim2.new(1,-10,0,25)
        apply.Position = UDim2.new(0,5,1,-30)
        apply.BackgroundColor3 = COLOR_ORANGE
        apply.BorderSizePixel = 0
        apply.Text = "Apply"
        apply.Font = Enum.Font.SourceSansBold
        apply.TextSize = 13
        apply.TextColor3 = COLOR_BLACK
        apply.AutoButtonColor = false
        apply.Parent = card
        addCorner(apply, 6)

        apply.MouseButton1Click:Connect(function()
            bulletSpeed = w.speed
            smoothness = w.smooth
            predictionStrength = w.pred
            fovRadius = w.fov
            -- Sync cycles panel
            speedVal.Text  = tostring(bulletSpeed)
            smoothVal.Text = string.format("%.2f", smoothness)
            predVal.Text   = string.format("%.2fx", predictionStrength)
            fovVal.Text    = tostring(fovRadius)
            apply.Text = "Done!"
            apply.BackgroundColor3 = COLOR_GREEN
            task.wait(1)
            apply.Text = "Apply"
            apply.BackgroundColor3 = COLOR_ORANGE
        end)
    end
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--   BUTTON EVENTS â€” MAIN GUI
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
weaponBtn.MouseButton1Click:Connect(function()
    weaponFrame.Visible = not weaponFrame.Visible
    if weaponFrame.Visible then populateWeapons() end
end)

listBtn.MouseButton1Click:Connect(function()
    listFrame.Visible = not listFrame.Visible
    if listFrame.Visible then updateTargetList() end
end)

inmateToggle.MouseButton1Click:Connect(function()
    targetInmatesOnly = not targetInmatesOnly
    inmateToggle.Text = targetInmatesOnly and "Target ğŸ’¢: ON" or "Target ğŸ’¢: OFF"
    inmateToggle.BackgroundColor3 = targetInmatesOnly and Color3.fromRGB(255,100,100) or Color3.fromRGB(100,100,100)
end)

criminalToggle.MouseButton1Click:Connect(function()
    targetCriminals = not targetCriminals
    criminalToggle.Text = targetCriminals and "Target Criminals: ON" or "Target Criminals: OFF"
    criminalToggle.BackgroundColor3 = targetCriminals and COLOR_ORANGE or Color3.fromRGB(100,100,100)
end)

wallBtn.MouseButton1Click:Connect(function()
    wallCheckEnabled = not wallCheckEnabled
    wallBtn.Text = wallCheckEnabled and "Wall Check: ON" or "Wall Check: OFF"
    wallBtn.BackgroundColor3 = wallCheckEnabled and COLOR_GREEN or COLOR_RED
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--   BUTTON EVENTS â€” CYCLES GUI
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
aimPartCycleBtn.MouseButton1Click:Connect(function()
    if     aimPart == "Head"              then aimPart = "Torso"
    elseif aimPart == "Torso"             then aimPart = "HumanoidRootPart"
    else                                       aimPart = "Head" end
    aimPartVal.Text = aimPart
end)

fovCycleBtn.MouseButton1Click:Connect(function()
    fovRadius = fovRadius + 50
    if fovRadius > maxFovRadius then fovRadius = minFovRadius end
    fovVal.Text = tostring(fovRadius)
end)

speedCycleBtn.MouseButton1Click:Connect(function()
    bulletSpeed = bulletSpeed + bulletSpeedStep
    if bulletSpeed > maxBulletSpeed then bulletSpeed = minBulletSpeed end
    speedVal.Text = tostring(bulletSpeed)
end)

smoothCycleBtn.MouseButton1Click:Connect(function()
    smoothness = smoothness + smoothnessStep
    if smoothness > maxSmoothness then smoothness = minSmoothness end
    smoothVal.Text = string.format("%.2f", smoothness)
end)

predCycleBtn.MouseButton1Click:Connect(function()
    predictionStrength = predictionStrength + predictionStep
    if predictionStrength > maxPredictionStrength then predictionStrength = minPredictionStrength end
    predVal.Text = string.format("%.2fx", predictionStrength)
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--   AIM ASSIST LOGIC
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local rayParams = RaycastParams.new()
rayParams.FilterType = Enum.RaycastFilterType.Exclude
local raycastFilter = {player.Character, camera}

local function hasLineOfSight(target)
    if not wallCheckEnabled then return true end
    if not target or not target.Parent then return false end
    raycastFilter[1] = player.Character
    rayParams.FilterDescendantsInstances = raycastFilter
    local origin = camera.CFrame.Position
    local result = Workspace:Raycast(origin, target.Position - origin, rayParams)
    if not result then return true end
    return result.Instance:IsDescendantOf(target.Parent)
end

local function predictPosition(target)
    if not target or not target.Parent or predictionStrength <= 0 then
        return target and target.Position or nil
    end
    local vel = target.AssemblyLinearVelocity
    if vel.Magnitude < 1 then return target.Position end
    local dist = (target.Position - camera.CFrame.Position).Magnitude
    return target.Position + vel * ((dist / bulletSpeed) + reactionTime) * predictionStrength
end

local viewportX, viewportY = 0, 0
local function updateCenter()
    local vs = camera.ViewportSize
    viewportX = vs.X * 0.5
    viewportY = vs.Y * 0.5
end
updateCenter()
camera:GetPropertyChangedSignal("ViewportSize"):Connect(updateCenter)

local function findTarget()
    local closest, closestDist = nil, math.huge
    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= player then
            local valid = (targetInmatesOnly and p.Name:find(INMATE_MARKER)) or
                          (targetCriminals and p.Team and p.Team.Name == CRIMINAL_TEAM_NAME)
            if valid then
                local char = p.Character
                if char then
                    local part = char:FindFirstChild(aimPart) or char:FindFirstChild("Head")
                    local hum  = char:FindFirstChild("Humanoid")
                    if part and hum and hum.Health > 0 then
                        local sp, onScreen = camera:WorldToViewportPoint(part.Position)
                        if onScreen then
                            local dx, dy = sp.X - viewportX, sp.Y - viewportY
                            if (dx*dx + dy*dy)^0.5 <= fovRadius then
                                local wd = (part.Position - camera.CFrame.Position).Magnitude
                                if wd < closestDist and hasLineOfSight(part) then
                                    closestDist = wd
                                    closest = part
                                end
                            end
                        end
                    end
                end
            end
        end
    end
    return closest
end

local loopRunning = false
local lastTarget, acquireTime = nil, 0

local function aimLoop()
    if loopRunning then return end
    loopRunning = true
    while aimAssistEnabled do
        local target = findTarget()
        if target ~= lastTarget then
            acquireTime = tick()
            lastTarget = target
        end
        if target and (tick() - acquireTime >= reactionTime) then
            local pos = predictPosition(target)
            if pos then
                camera.CFrame = camera.CFrame:Lerp(CFrame.new(camera.CFrame.Position, pos), smoothness)
            end
        end
        RunService.RenderStepped:Wait()
    end
    loopRunning = false
end

aimBtn.MouseButton1Click:Connect(function()
    aimAssistEnabled = not aimAssistEnabled
    aimBtn.Text = aimAssistEnabled and "Disable Aim Assist" or "Enable Aim Assist"
    aimBtn.BackgroundColor3 = aimAssistEnabled and COLOR_GREEN or COLOR_RED
    if aimAssistEnabled then
        lastTarget = nil
        task.spawn(aimLoop)
    end
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
--   BACKGROUND POLLING
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
task.spawn(function()
    while task.wait(2) do
        updateCounters()
        if listFrame.Visible then updateTargetList() end
    end
end)

Players.PlayerAdded:Connect(updateCounters)
Players.PlayerRemoving:Connect(updateCounters)

print("âœ… Optimized Prison Life Aim Assist Ready!")
